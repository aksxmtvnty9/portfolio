---
import { getCollection } from 'astro:content';
import PageLayout from '@layouts/PageLayout.astro';
import Link from '@components/Link.astro';
import { SITE } from '@consts';

// Get recent work (2 most recent)
const works = (await getCollection('work'))
  .filter(work => !work.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 2);

// Get recent blog posts (3 most recent)
const posts = (await getCollection('blog'))
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

// Get recent projects (3 most recent)
const projects = (await getCollection('projects'))
  .filter(project => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<PageLayout title={SITE.NAME} description={SITE.DESCRIPTION}>
  <!-- Hero Section -->
  <section class="animate py-8 md:py-16">
    <h1 class="text-4xl font-semibold text-primary mb-6">
      Hi, I'm Anush üëã
    </h1>
    
    <div class="space-y-4 text-primary max-w-2xl">
      <p>
        I'm a <span class="text-accent">software engineer</span> with 5+ years of experience building products that scale. I work across the stack with a focus on React, TypeScript, and system architecture‚Äîturning complex problems into reliable solutions. I care about clean code, performance, and shipping features that make a difference.
      </p>
      
      <p>
        Outside of work, I'm into cars, self-hosting my own services, watching movies, and occasionally playing keyboard when inspiration strikes.
      </p>
    </div>
    
    <p class="mt-8 text-sm text-secondary italic">
      Based in India 
      (<a class="text-secondary hover:text-primary" href="https://maps.app.goo.gl/hd5SAZ7Z3gQsgwgYA" target="_blank">11.004556, 76.961632</a>).
    </p>
  </section>

  <!-- Gradient Divider -->
  <div class="py-2">
    <div class="h-px w-full bg-gradient-to-r from-transparent via-[#E5E0D8] dark:via-[#3D3833] to-transparent"></div>
  </div>

  <!-- Work Timeline Section -->
  <section class="animate py-12">
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-xl font-semibold text-primary">Work Experience</h2>
      <Link href="/work" class="text-sm text-secondary hover:text-accent transition-colors">
        View full timeline ‚Üí
      </Link>
    </div>
    
    <div class="space-y-8">
      {works.map((work, index) => (
        <div class="relative">
          <!-- Connecting line -->
          {index < works.length - 1 && (
            <div class="absolute left-8 top-full w-px h-8 bg-secondary/50"></div>
          )}
          
          <!-- Timeline dot -->
          <div class="absolute left-6 top-6 w-4 h-4 rounded-full bg-accent border-4 border-primary z-10"></div>
          
          <!-- Card -->
          <Link href={`/work/${work.slug}`} class="block group ml-12">
            <div class="bg-secondary rounded-lg p-6 shadow-sm border border-secondary hover:shadow-[0_4px_20px_rgba(182,176,159,0.25)] transition-all duration-200">
              {/* Header with date and company */}
              <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3">
                <div>
                  <h3 class="text-lg font-semibold text-primary group-hover:text-accent transition-colors">
                    {work.data.title}
                  </h3>
                  <p class="text-sm text-secondary mt-1 italic">
                    {work.data.description}
                  </p>
                </div>
                <span class="text-sm text-secondary font-medium whitespace-nowrap">
                  {new Date(work.data.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} - {work.data.endDate instanceof Date ? new Date(work.data.endDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : work.data.endDate || 'Current'}
                </span>
              </div>
              
              {/* Location */}
              <p class="text-sm text-secondary mb-3">
                üìç {work.data.location}
              </p>
              
              {/* Short Summary */}
              <p class="text-primary text-sm leading-relaxed">
                {work.data.shortSummary}
              </p>
            </div>
          </Link>
        </div>
      ))}
    </div>
  </section>
 
  <!-- Gradient Divider -->
  <div class="py-2">
    <div class="h-px w-full bg-gradient-to-r from-transparent via-[#E5E0D8] dark:via-[#3D3833] to-transparent"></div>
  </div>

  <!-- Blog Section -->
  <section class="animate py-8">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold text-primary">Recent Posts</h2>
      <Link href="/blog" class="text-sm text-secondary hover:text-accent transition-colors">
        View all ‚Üí
      </Link>
    </div>
    {posts.length > 0 ? (
      <div class="space-y-4">
        {posts.map((post) => (
          <Link href={`/blog/${post.slug}`} class="block group">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1">
              <h3 class="font-medium text-primary group-hover:text-accent transition-colors">
                {post.data.title}
              </h3>
              <span class="text-sm text-secondary">
                {new Date(post.data.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
              </span>
            </div>
            <p class="text-sm text-primary mt-1">
              {post.data.description}
            </p>
          </Link>
        ))}
      </div>
    ) : (
      <p class="text-secondary text-sm italic">
        No blog posts yet. Check back soon!
      </p>
    )}
  </section>
  
  <!-- Gradient Divider -->
  <div class="py-2">
    <div class="h-px w-full bg-gradient-to-r from-transparent via-[#E5E0D8] dark:via-[#3D3833] to-transparent"></div>
  </div>

  <!-- Projects Section -->
  <section class="animate pt-8">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-semibold text-primary">Recent Projects</h2>
      <Link href="/projects" class="text-sm text-secondary hover:text-accent transition-colors">
        View all ‚Üí
      </Link>
    </div>
    {projects.length > 0 ? (
      <div class="space-y-4">
        {projects.map((project) => (
          <Link href={`/projects/${project.slug}`} class="block group">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1">
              <h3 class="font-medium text-primary group-hover:text-accent transition-colors">
                {project.data.title}
              </h3>
              <span class="text-sm text-secondary">
                {new Date(project.data.date).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}
              </span>
            </div>
            <p class="text-sm text-primary mt-1">
              {project.data.description}
            </p>
          </Link>
        ))}
      </div>
    ) : (
      <p class="text-secondary text-sm italic">
        No projects yet. Check back soon!
      </p>
    )}
  </section>
</PageLayout>
